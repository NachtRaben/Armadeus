buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.2'
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'idea'
    apply plugin: 'com.github.johnrengelman.shadow'

    // Variables
    group = 'com.nachtraben'
    version = '2.0'
    final def buildTag = System.getenv("BUILD_TAG") ?: "unknown"
    final def buildNumber = System.getenv("BUILD_NUMBER") ?: "unknown"
    final def gitCommit = System.getenv("GIT_COMMIT") ?: "unknown"
    final def gitBranch = System.getenv("GIT_BRANCH") ?: "unknown"

    // Encodings
    compileJava.options.encoding = 'UTF-8'
    javadoc.options.encoding = 'UTF-8'
    
    // Compatibilities
    sourceCompatibility = '1.8'
    targetCompatibility = '1.8'

    repositories {
        mavenLocal()
        maven { url = 'https://jitpack.io' }
        maven { url = "https://dl.bintray.com/kodehawa/maven" }
        mavenCentral()
        jcenter()
    }

    configurations {
        testCompile.extendsFrom shadow, compile
    }

    shadowJar {
        classifier = ""
    }

    task pushLocally(dependsOn: shadowJar) {
        doLast {
            def failed = tasks.shadowJar.state.failure
            if(failed)
                return
            try {
                def connection = new Socket("tohsaka-vps", 13380)
                connection.close()
            } catch (Exception e) {
                e.printStackTrace()
            }
        }
    }

}

